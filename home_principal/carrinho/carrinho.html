<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Meu Carrinho | CHATUAL DU PET</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../home_principal/css/style.css"> 
    
    <style>
        /* Cor principal do Chatual Du Pet */
        :root {
            --chateau-purple: #89006A;
            --chateau-light-purple: #f3e9f0;
            --chateau-green: #689f38;
        }

        .page-title {
            color: var(--chateau-purple);
            font-weight: bold;
            margin-bottom: 1.5rem;
        }

        /* --- Estilo do Cabe√ßalho --- */
        .navbar {
            background-color: var(--chateau-purple) !important;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        .navbar-brand, .nav-link, .menu-todos a {
            color: white !important;
        }
        
        /* Estilo para deixar a seta sozinha */
        .header-back-button {
            font-size: 24px;
            text-decoration: none;
            color: white !important;
        }

        /* --- Estilo do Item do Carrinho --- */
        .cart-item-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .cart-product-line {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .cart-item-info {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        .cart-item-info img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 20px;
            border: 1px solid #eee;
        }
        .item-details h6 {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .item-details small {
            color: #999;
        }

        /* Controle de Quantidade */
        .quantity-control {
            display: flex;
            align-items: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            overflow: hidden;
            height: 35px;
        }
        .quantity-control button {
            background-color: #fff;
            color: #555;
            border: none;
            width: 30px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            font-size: 1.2rem;
        }
        .quantity-control input {
            width: 40px;
            text-align: center;
            border: none;
            margin: 0;
            padding: 0;
            height: 100%;
        }

        /* Pre√ßos e Remo√ß√£o */
        .item-pricing {
            text-align: right;
            margin-left: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        .item-price {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
        }
        
        .remove-item-btn {
            background-color: transparent;
            color: #aaa;
            border: none;
            font-size: 1.5rem;
            margin-left: 15px;
            padding: 0;
            line-height: 1;
        }

        /* Op√ß√£o de Retirada na Loja */
        .pickup-option {
            display: flex;
            align-items: center;
            padding-top: 10px;
            justify-content: space-between;
        }
        .pickup-option .form-check-label {
            color: var(--chateau-purple);
            font-weight: 500;
        }
        .pickup-option-price {
            /* Mantido para poss√≠veis descontos/textos futuros, mas o "economize 0,00" foi removido */
            color: #dc3545;
            font-weight: bold;
            font-size: 0.95rem;
        }

        /* Resumo */
        .total-price {
            font-size: 1.5rem;
            color: var(--chateau-purple);
            font-weight: bold;
        }
        .checkout-btn {
            background-color: var(--chateau-purple);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            margin-top: 15px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .checkout-btn:hover {
            background-color: #6a0052;
        }
        .summary-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Bloco Localiza√ß√£o */
        .nearest-units-card {
            background-color: var(--chateau-light-purple);
            border: 1px solid #e0cbe0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .nearest-units-card h5 {
            color: var(--chateau-purple);
            font-weight: bold;
        }
        .nearest-units-card .btn-primary {
            background-color: var(--chateau-purple);
            border-color: var(--chateau-purple);
        }
        .location-section .btn-check-availability {
            background-color: var(--chateau-purple);
            color: white;
            border: none;
            font-weight: bold;
        }
        .coupon-section .btn-apply {
            background-color: var(--chateau-green);
            color: white;
            border: none;
            font-weight: bold;
        }

    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg shadow-sm">
        <div class="container d-flex align-items-center justify-content-between">
            
            <a class="header-back-button" href="../home_principal/home.html" title="Voltar √†s Compras">
                ‚Üê
            </a>

            <a class="navbar-brand fw-bold text-white d-flex align-items-center mx-auto" href="../home_principal/home.html">
                <span class="d-none d-md-inline">MEU CARRINHO</span>
            </a>

            <div style="width: 24px;"></div>
        </div>
    </nav>
    
    <div class="container my-5">
        <h1 class="page-title" id="cart-title">üõí Produtos no Seu Carrinho (3 Itens)</h1>
        
        <div class="row">
            <div class="col-lg-8">
                
                <h5 class="mb-3">Produtos</h5>
                <button class="btn btn-sm btn-outline-secondary mb-3" id="btnClearCart">Limpar Carrinho</button>

                <div id="cart-items-container">
                    
                    <div class="cart-item-container" data-unit-price="3.39">
                        <div class="cart-product-line">
                            <div class="cart-item-info">
                                <img src="../home_principal/img/racao1.webp" alt="Ra√ß√£o √ömida GranPlus">
                                <div class="item-details">
                                    <h6>Ra√ß√£o √ömida GranPlus Gourmet C√£es Adultos Ovelha 100 g</h6>
                                    <small>Vendido por: Chatual Du Pet</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="quantity-control me-4">
                                    <button type="button" class="btn-qty-minus">-</button>
                                    <input type="text" class="input-qty" value="1" min="1" readonly>
                                    <button type="button" class="btn-qty-plus">+</button>
                                </div>
                                <div class="item-pricing">
                                    <span class="item-price" data-total-price="3.39">R$ 3,39</span>
                                </div>
                                <button class="remove-item-btn" title="Remover item">√ó</button>
                            </div>
                        </div>
                        <div class="pickup-option">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="retirar1" value="option1">
                                <label class="form-check-label" for="retirar1">
                                    Retirar na Unidade
                                </label>
                            </div>
                            </div>
                    </div>

                    <div class="cart-item-container" data-unit-price="69.90">
                        <div class="cart-product-line">
                            <div class="cart-item-info">
                                <img src="../home_principal/img/racao2.webp" alt="Ra√ß√£o Seca C√£es">
                                <div class="item-details">
                                    <h6>Ra√ß√£o Seca Premier Pet Ra√ßas M√©dias Frango 2,5 kg</h6>
                                    <small>Vendido por: Chatual Du Pet</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="quantity-control me-4">
                                    <button type="button" class="btn-qty-minus">-</button>
                                    <input type="text" class="input-qty" value="1" min="1" readonly>
                                    <button type="button" class="btn-qty-plus">+</button>
                                </div>
                                <div class="item-pricing">
                                    <span class="item-price" data-total-price="69.90">R$ 69,90</span>
                                </div>
                                <button class="remove-item-btn" title="Remover item">√ó</button>
                            </div>
                        </div>
                        <div class="pickup-option">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="retirar2" value="option2">
                                <label class="form-check-label" for="retirar2">
                                    Retirar na Unidade
                                </label>
                            </div>
                            </div>
                    </div>
                    
                    <div class="cart-item-container" data-unit-price="17.90">
                        <div class="cart-product-line">
                            <div class="cart-item-info">
                                <img src="../home_principal/img/racao3.webp" alt="Petisco Natural">
                                <div class="item-details">
                                    <h6>Petisco Natural Osso Palito Bovino 500g</h6>
                                    <small>Vendido por: Chatual Du Pet</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center">
                                <div class="quantity-control me-4">
                                    <button type="button" class="btn-qty-minus">-</button>
                                    <input type="text" class="input-qty" value="2" min="1" readonly>
                                    <button type="button" class="btn-qty-plus">+</button>
                                </div>
                                <div class="item-pricing">
                                    <span class="item-price" data-total-price="35.80">R$ 35,80</span>
                                </div>
                                <button class="remove-item-btn" title="Remover item">√ó</button>
                            </div>
                        </div>
                        <div class="pickup-option">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="retirar3" value="option3">
                                <label class="form-check-label" for="retirar3">
                                    Retirar na Unidade
                                </label>
                            </div>
                            </div>
                    </div>

                </div> </div>

            <div class="col-lg-4">
                
                <div class="nearest-units-card">
                    <h5>Unidades Mais Pr√≥ximas</h5>
                    <p class="text-muted small">Verifique o estoque e as op√ß√µes de retirada em lojas perto de voc√™.</p>
                    <button class="btn btn-sm btn-primary w-100 mb-2" id="btnVerMapa">Ver Mapa de Lojas</button>
                    <button class="btn btn-sm btn-primary w-100" id="btnUpdateLocation">Atualizar Localiza√ß√£o</button>
                </div>
                <div class="summary-card">
                    <h4>Resumo do Pedido</h4>
                    <p><span>Produtos (<span id="summary-qty">3</span>):</span> <span>R$ <span id="summary-subtotal">109,09</span></span></p>
                    <p><span>Frete Estimado:</span> <span>R$ <span id="summary-shipping">15,00</span></span></p>
                    <hr>
                    <p class="h5 d-flex justify-content-between"><span>Total a Pagar:</span> <span class="total-price">R$ <span id="summary-total">124,09</span></span></p>
                    <button class="checkout-btn">Finalizar Compra</button>
                    <a href="../home_principal/home.html" class="btn btn-sm btn-light w-100 mt-2 text-decoration-none" style="color: var(--chateau-purple); border: 1px solid #ddd;">Continuar Comprando</a>
                </div>

            </div>
        </div>

        <div class="row mt-5 location-section">
            
            <div class="col-lg-6">
                <h5>Consultar Disponibilidade na Unidade Mais Pr√≥xima</h5>
                <p class="small text-muted">Verifique se os produtos est√£o dispon√≠veis para retirada imediata na loja de sua prefer√™ncia.</p>
                <div class="d-flex">
                    <input type="text" class="form-control me-2" id="inputCEP" placeholder="Insira seu CEP">
                    <button class="btn btn-check-availability" id="btnBuscarCEP">Buscar</button>
                </div>
                <div class="mt-3">
                    <button class="btn btn-outline-secondary btn-sm" id="btnUseCurrentLocation">Usar minha localiza√ß√£o atual</button>
                </div>
            </div>

            <div class="col-lg-6 coupon-section">
                <h5>Cupom de Desconto <span class="text-muted small ms-1">(i)</span></h5>
                <p class="small text-muted">Insira o c√≥digo do seu cupom e economize no pedido.</p>
                <div class="d-flex">
                    <input type="text" class="form-control me-2" placeholder="Insira seu cupom aqui">
                    <button class="btn btn-apply">Aplicar</button>
                </div>
            </div>
            
        </div>
        
    </div>

    <footer class="mt-5 py-3 text-center" style="background-color: var(--chateau-light-purple); border-top: 1px solid #e0cbe0;">
        <p class="mb-0 small" style="color: var(--chateau-purple);">¬© 2025 CHATUAL DU PET - Todos os direitos reservados</p>
        <p class="mb-0 small text-muted">Pol√≠tica de Entrega, Fretes e Descontos | Central de Ajuda</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const cartContainer = document.getElementById('cart-items-container');
        const cartTitle = document.getElementById('cart-title');
        const btnClearCart = document.getElementById('btnClearCart');
        const btnVerMapa = document.getElementById('btnVerMapa');
        const btnBuscarCEP = document.getElementById('btnBuscarCEP');
        const btnUpdateLocation = document.getElementById('btnUpdateLocation');
        const btnUseCurrentLocation = document.getElementById('btnUseCurrentLocation');
        const lojasPage = '../lojas/lojas.html'; 
        
        // --- FUN√á√ïES DE C√ÅLCULO E ATUALIZA√á√ÉO DO RESUMO ---

        function formatCurrency(value) {
            return parseFloat(value).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function calculateCartSummary() {
            let subtotal = 0;
            let totalQty = 0;
            const shipping = 15.00; 

            document.querySelectorAll('.cart-item-container').forEach(item => {
                const totalPriceElement = item.querySelector('.item-price');
                const qty = parseInt(item.querySelector('.input-qty').value);
                const unitPrice = parseFloat(item.dataset.unitPrice);
                
                const itemTotal = qty * unitPrice;
                
                totalPriceElement.dataset.totalPrice = itemTotal.toFixed(2);
                totalPriceElement.textContent = `R$ ${formatCurrency(itemTotal)}`;
                
                subtotal += itemTotal;
                totalQty += qty;
            });
            
            const total = subtotal + shipping;

            // Atualiza os elementos de resumo
            document.getElementById('summary-subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('summary-qty').textContent = totalQty;
            document.getElementById('summary-shipping').textContent = formatCurrency(shipping);
            document.getElementById('summary-total').textContent = formatCurrency(total);
            
            // Atualiza o t√≠tulo do carrinho
            cartTitle.textContent = `üõí Produtos no Seu Carrinho (${totalQty} Itens)`;

            // Exibe a mensagem de carrinho vazio se necess√°rio
            if (totalQty === 0) {
                 cartContainer.innerHTML = '<p class="text-center text-muted p-5">Seu carrinho est√° vazio. Adicione produtos para continuar!</p>';
                 btnClearCart.style.display = 'none';
            } else {
                 btnClearCart.style.display = 'inline-block';
            }
        }
        
        // --- L√ìGICA DE QUANTIDADE, REMO√á√ÉO E LIMPEZA ---
        
        cartContainer.addEventListener('click', (e) => {
            const button = e.target;
            const isMinus = button.classList.contains('btn-qty-minus');
            const isPlus = button.classList.contains('btn-qty-plus');

            if (isMinus || isPlus) {
                const itemContainer = button.closest('.cart-item-container');
                const qtyInput = itemContainer.querySelector('.input-qty');
                let currentQty = parseInt(qtyInput.value);
                
                if (isPlus) {
                    currentQty++;
                } else if (isMinus && currentQty > 1) {
                    currentQty--;
                }
                
                qtyInput.value = currentQty;
                calculateCartSummary();
            }

            // L√≥gica para remover item
            if (button.classList.contains('remove-item-btn')) {
                if (confirm('Tem certeza que deseja remover este item do carrinho?')) {
                    button.closest('.cart-item-container').remove();
                    calculateCartSummary();
                }
            }
        });


        // Limpar Carrinho
        btnClearCart.addEventListener('click', () => {
             if (confirm('Tem certeza que deseja limpar todo o carrinho?')) {
                document.querySelectorAll('.cart-item-container').forEach(item => item.remove());
                calculateCartSummary(); 
             }
        });

        // --- L√ìGICA DE LOCALIZA√á√ÉO E REDIRECIONAMENTOS ---

        function handleGeolocation() {
            if (navigator.geolocation) {
                alert('O site est√° pedindo sua permiss√£o para atualizar a localiza√ß√£o. (Aguardando permiss√£o do navegador)');
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // Simula√ß√£o: A geolocaliza√ß√£o foi bem-sucedida
                        alert(`Localiza√ß√£o atualizada com sucesso! (Lat: ${position.coords.latitude}, Long: ${position.coords.longitude}). Agora voc√™ pode consultar o estoque!`);
                    },
                    (error) => {
                        // Simula√ß√£o: O usu√°rio negou ou houve erro
                        alert(`Erro ao obter localiza√ß√£o: ${error.message}. Por favor, insira o CEP para consultar a loja mais pr√≥xima.`);
                    }
                );
            } else {
                alert('Seu navegador n√£o suporta Geolocaliza√ß√£o. Por favor, insira o CEP.');
            }
        }
        
        // Redirecionamento para o Mapa de Lojas
        btnVerMapa.addEventListener('click', () => {
            window.location.href = lojasPage;
        });

        // Busca por CEP e redireciona (com destaque se for Tatuap√©)
        btnBuscarCEP.addEventListener('click', () => {
            const cepInput = document.getElementById('inputCEP');
            const cep = cepInput.value.replace(/\D/g, '');

            if (cep === '03207000') {
                alert(`CEP ${cep} detectado. Redirecionando para a loja Tatuap√©!`);
                window.location.href = `${lojasPage}?loja=tatuape`;
            } else {
                alert('Buscando unidades pr√≥ximas e disponibilidade! (L√≥gica de backend)');
                window.location.href = lojasPage;
            }
        });

        // Conecta os dois bot√µes de localiza√ß√£o √† mesma fun√ß√£o
        btnUpdateLocation.addEventListener('click', handleGeolocation);
        btnUseCurrentLocation.addEventListener('click', handleGeolocation);
        
        // Inicializa o resumo ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', calculateCartSummary);
    </script>
</body>
</html>